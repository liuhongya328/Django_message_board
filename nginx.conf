user  www www;
worker_processes auto;
error_log  /www/wwwlogs/nginx_error.log  crit;
pid        /www/server/nginx/logs/nginx.pid;
worker_rlimit_nofile 51200;

#stream {
#    log_format tcp_format '$time_local|$remote_addr|$protocol|$status|$bytes_sent|$bytes_received|$session_time|$upstream_addr|$upstream_bytes_sent|$upstream_bytes_received|$upstream_connect_time';
#    server{
#	listen 19301;
#	proxy_pass 220.248.252.65:465;
#    } 
#    access_log /www/wwwlogs/tcp-access.log tcp_format;
#    error_log /www/wwwlogs/tcp-error.log;
#    include /www/server/panel/vhost/nginx/tcp/*.conf;
#}

events
    {
        use epoll;
        worker_connections 51200;
        multi_accept on;
    }

http
    {
        include       mime.types;
		#include luawaf.conf;

		include proxy.conf;

        default_type  application/octet-stream;

        log_format access $remote_user $remote_addr:$remote_port $server_protocol $request_method $scheme://$http_host$request_uri "$status";
        
        server_names_hash_bucket_size 512;
        client_header_buffer_size 32k;
        large_client_header_buffers 4 32k;
        client_max_body_size 50m;

        sendfile   on;
        tcp_nopush on;

        keepalive_timeout 60;

        tcp_nodelay on;

        fastcgi_connect_timeout 300;
        fastcgi_send_timeout 300;
        fastcgi_read_timeout 300;
        fastcgi_buffer_size 64k;
        fastcgi_buffers 4 64k;
        fastcgi_busy_buffers_size 128k;
        fastcgi_temp_file_write_size 256k;
		fastcgi_intercept_errors on;

        gzip on;
        gzip_min_length  1k;
        gzip_buffers     4 16k;
        gzip_http_version 1.1;
        gzip_comp_level 2;
        gzip_types     text/plain application/javascript application/x-javascript text/javascript text/css application/xml;
        gzip_vary on;
        gzip_proxied   expired no-cache no-store private auth;
        gzip_disable   "MSIE [1-6]\.";

        limit_conn_zone $binary_remote_addr zone=perip:10m;
		limit_conn_zone $server_name zone=perserver:10m;

        server_tokens off;
        access_log off;

server
    {
        listen 888;
        server_name phpmyadmin;
        index index.html index.htm index.php;
        root  /www/server/phpmyadmin;

        #error_page   404   /404.html;
        include enable-php.conf;

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
        {
            expires      30d;
        }

        location ~ .*\.(js|css)?$
        {
            expires      12h;
        }

        location ~ /\.
        {
            deny all;
        }

        access_log  /www/wwwlogs/access.log;
    }

server
    {
        listen 19301;
       server_name 39.99.140.176;
        index index.html index.htm index.php;
        root  /www/server/phpmyadmin;

        proxy_connect_timeout 600;
	proxy_read_timeout 600;
	proxy_send_timeout 600;

        #error_page   404   /404.html;
       # include enable-php.conf;

	location / {
 	#	proxy_set_header X-Real-IP $remote_addr;
        #    proxy_set_header X-Forward-For $proxy_add_x_forwarded_for;
       #  proxy_set_header Host registry.npmmirror.com;
	#add_header Access-Control-Allow-Origin *;
	#add_header Access-Control-Allow-Headers X-Requested-With;
	# proxy_pass https://registry.npmmirror.com;
           #proxy_pass http://47.100.225.188:48081;
         proxy_pass https://ucapi.sdycsdyc.cn/actuator/health;
	}
	location /cgi-bin/ {
            proxy_pass https://api.weixin.qq.com/cgi-bin/;
        }
        location /sns/ {
            proxy_pass https://api.weixin.qq.com/sns/;
        }
	location /feishu/ {
                 proxy_pass https://open.feishu.cn/;
         }
        location /mmbiz/ {
                 proxy_pass http://mmbiz.qpic.cn/;
         }	
	location /open-apis/ {
                 proxy_pass https://open.huibangong.psbc-ubank.com/open-apis/;
         }
        location /mis/wxapiwxqq/ {
            proxy_pass https://api.weixin.qq.com/;
        }
        location /mis/wxfileapi/ {
            proxy_pass https://file.api.weixin.qq.com/;
        }
        location /mis/wxmpweixin/ {
            proxy_pass https://mp.weixin.qq.com/;
        }
        location /mis/wxapimch/ {
            proxy_pass https://api.mch.weixin.qq.com/;
        }
        location /mis/wxopenwixin/ {
            proxy_pass https://open.weixin.qq.com/;
        }
        location /mis/wxthirdwxqlogo/ {
            proxy_pass https://thirdwx.qlogo.cn/;
        }
	location /api/notify/1138/ {
            proxy_pass https://d.inte.chanjet.com/api/notify/1138/;
        }
        
	set $gaode restapi.amap.com;
        location /gaode/ {
            proxy_pass https://restapi.amap.com/;
	    proxy_set_header Host $gaode;
	    proxy_redirect off; 
        }

        location /chanjet/finance/ {
            proxy_pass https://finance.inte.chanjet.com/;
        } 
        location /chanjet/erpdata/ {
            proxy_pass https://erpdata-chanapp.inte.chanjet.com/;
        }
	location /tonglian/ {
            proxy_pass https://tlt-test.allinpay.com/;
        }
	location /bangongyi/ {
            proxy_pass http://vvapi.rongzhidui.com/;
        }
	set $keyike keyike.ltd;
	location ~ /keyike/(.*) {
            proxy_pass https://$keyike/$1?$args;
	    proxy_set_header Host $keyike;
	    proxy_redirect off;
	    proxy_ssl_name $keyike;
	    proxy_ssl_server_name on;
	    proxy_ssl_verify off;
        }
	location ~ /keyike1/(.*) {
            proxy_pass https://$keyike/$1?$args;
            proxy_set_header Host $keyike;
            proxy_redirect off;
        }
	location /ksr-api/callback {
            proxy_pass https://keyike.ltd;
            proxy_set_header Host keyike.ltd;
            proxy_redirect off;
	    proxy_ssl_protocols TLSv1.3;
        }	
	#set $ixinnuo xsdt1.i-xinnuo.com;
	location /ixinnuo/ {
            proxy_pass https://xsdt1.i-xinnuo.com/;
            proxy_set_header Host xsdt1.i-xinnuo.com;
	    proxy_redirect off;
        }
	set $wangDianTech 82.157.135.167;
        location ~ /wangDianTech/(.*) {
            proxy_pass http://$wangDianTech:80/$1?$args;
            proxy_set_header Host $wangDianTech;
	    proxy_redirect off;
        }
        access_log  /www/wwwlogs/access.log ;
    }

server
    {
        listen 17201;
        server_name 39.99.140.176;
        index index.html index.htm index.php;
        #root  /www/server/phpmyadmin;

        proxy_connect_timeout 600;
        proxy_read_timeout 600;
        proxy_send_timeout 600;


        location / {
        #       proxy_set_header X-Real-IP $remote_addr;
        #    proxy_set_header X-Forward-For $proxy_add_x_forwarded_for;
       #  proxy_set_header Host registry.npmmirror.com;
        #add_header Access-Control-Allow-Origin *;
        #add_header Access-Control-Allow-Headers X-Requested-With;
        # proxy_pass https://registry.npmmirror.com;
           proxy_pass https://ucapi.sdycsdyc.cn/actuator/health;
        }



        access_log  /www/wwwlogs/access.log ;
    }

    server
        {
            listen 9001;
            server_name 39.99.140.176;
            index index.html index.htm index.php;
            proxy_connect_timeout 600;
            proxy_read_timeout 600;
            proxy_send_timeout 600;
        
            location /cgi-bin/ {
                proxy_pass https://api.weixin.qq.com/cgi-bin/;
            } 
            location /sns/ {
                proxy_pass https://api.weixin.qq.com/sns/;
            }
	    location /qiaochang/ {
           #	 proxy_pass https://47.100.214.144:9444/;
            }


            access_log  /www/wwwlogs/access.log ;
    }
    server
        {
            listen 80;
            server_name 39.99.140.176;
            index index.html index.htm index.php;
            proxy_connect_timeout 600;
            proxy_read_timeout 600;
            proxy_send_timeout 600;

            location /gateway/ {
             #   proxy_pass https://app.test.psbc-ubank.com:17002/gateway/;
            }
	    location / {
                root html;
            }
	    location /api/ {
            #    proxy_pass https://open.huibangong.psbc-ubank.com/;
            }
            access_log  /www/wwwlogs/access.log ;
    }

server
    {
        listen 8000;
        server_name 39.99.140.176;
        index index.html index.htm index.php;
        #root  /www/server/phpmyadmin;

        proxy_connect_timeout 600;
        proxy_read_timeout 600;
        proxy_send_timeout 600;


        location / {
           proxy_pass https://127.0.0.1:8000/;
        }

        access_log  /www/wwwlogs/access.log ;
    }

include /www/server/panel/vhost/nginx/*.conf;
}

